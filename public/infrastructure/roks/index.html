<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The Cloud Pak Production Deployment Guides document and demonstrate how to run cloud-native solutions leveraging IBM Cloud Pak capabilities in a Red Hat OpenShift environment"><meta name=author content="Cloud Pak Production Deployment Guides development team"><link rel=icon href=../../images/cloudnativetoolkit.png><meta name=generator content="mkdocs-1.2.2, mkdocs-material-7.3.0"><title>IBM ROKS - Cloud Pak Production Deployment Guides</title><link rel=stylesheet href=../../assets/stylesheets/main.8b42a75e.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CIBM+Plex+Mono&display=fallback"><style>:root{--md-text-font-family:"IBM Plex Sans";--md-code-font-family:"IBM Plex Mono"}</style><link rel=stylesheet href=../../css/extra.css><link rel=stylesheet href=../../css/toolkit-code.css><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q0FLL49YN3"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-Q0FLL49YN3",{page_path:t.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-Q0FLL49YN3"></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Cloud Pak Production Deployment Guides - IBM ROKS"><meta property=og:description content="The Cloud Pak Production Deployment Guides document and demonstrate how to run cloud-native solutions leveraging IBM Cloud Pak capabilities in a Red Hat OpenShift environment"><meta property=og:url content=None><meta property=og:image content=assets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1080><meta property=og:image:height content=568></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#ibm-red-hat-openshift-kubernetes-service-roks class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Cloud Pak Production Deployment Guides" class="md-header__button md-logo" aria-label="Cloud Pak Production Deployment Guides" data-md-component=logo> <img src=../../images/cloudnativetoolkit.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Cloud Pak Production Deployment Guides </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> IBM ROKS </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.ibm.com/cloudpakbringup/production-deployment-guides/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../overview/whats-new/ class=md-tabs__link> What's New </a> </li> <li class=md-tabs__item> <a href=../../overview/overview/ class=md-tabs__link> Production Reference </a> </li> <li class=md-tabs__item> <a href=../../overview/using/ class="md-tabs__link md-tabs__link--active"> Hands-on </a> </li> <li class=md-tabs__item> <a href=../../contribute/documentation/ class=md-tabs__link> References </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Determine class according to configuration --> <!-- Main navigation --> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <!-- Site title --> <!--
  <label class="md-nav__title" for="__drawer">
    <a
      href="../.."
      title="Cloud Pak Production Deployment Guides"
      class="md-nav__button md-logo"
      aria-label="Cloud Pak Production Deployment Guides"
      data-md-component="logo"
    >
      
  <img src="../../images/cloudnativetoolkit.png" alt="logo">

    </a>
    Cloud Pak Production Deployment Guides
  </label>
--> <!-- Repository information --> <div class=md-nav__source> <a href=https://github.ibm.com/cloudpakbringup/production-deployment-guides/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../overview/whats-new/ class=md-nav__link> What's New </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Production Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Production Reference" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Production Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/overview/ class=md-nav__link> Objective </a> </li> <li class=md-nav__item> <a href=../../gitops/personas/ class=md-nav__link> Personas </a> </li> <li class=md-nav__item> <a href=../../automation/why-automate/ class=md-nav__link> Automation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> OpenShift Deployment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="OpenShift Deployment" data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> OpenShift Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4_1 type=checkbox id=__nav_3_4_1> <label class=md-nav__link for=__nav_3_4_1> Golden Topology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Golden Topology" data-md-level=3> <label class=md-nav__title for=__nav_3_4_1> <span class="md-nav__icon md-icon"></span> Golden Topology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../golden-topology/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../golden-topology-azure/ class=md-nav__link> Azure Unmanaged </a> </li> <li class=md-nav__item> <a href=../golden-topology-aro/ class=md-nav__link> Azure Managed (ARO) </a> </li> <li class=md-nav__item> <a href=../golden-topology-aws/ class=md-nav__link> AWS Unmanaged </a> </li> <li class=md-nav__item> <a href=../golden-topology-rosa/ class=md-nav__link> AWS Managed (ROSA) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ad/ class=md-nav__link> Architectural Decisions </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> Cloud Pak Production Considerations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cloud Pak Production Considerations" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Cloud Pak Production Considerations </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_1 type=checkbox id=__nav_3_5_1> <label class=md-nav__link for=__nav_3_5_1> App Connect Enterprise <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="App Connect Enterprise" data-md-level=3> <label class=md-nav__title for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> App Connect Enterprise </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/ace/overview/architecture/ class=md-nav__link> Architecture </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_2 type=checkbox id=__nav_3_5_2> <label class=md-nav__link for=__nav_3_5_2> MQ <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MQ data-md-level=3> <label class=md-nav__title for=__nav_3_5_2> <span class="md-nav__icon md-icon"></span> MQ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/overview/architecture/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/security/information/overview/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/high-availability/overview/ class=md-nav__link> High Availability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_3 type=checkbox id=__nav_3_5_3> <label class=md-nav__link for=__nav_3_5_3> API Connect <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="API Connect" data-md-level=3> <label class=md-nav__title for=__nav_3_5_3> <span class="md-nav__icon md-icon"></span> API Connect </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_3_1 type=checkbox id=__nav_3_5_3_1> <label class=md-nav__link for=__nav_3_5_3_1> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=4> <label class=md-nav__title for=__nav_3_5_3_1> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/apic/architecture/ibm-cloud/ class=md-nav__link> IBM Cloud </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/apic/architecture/multi-cloud/ class=md-nav__link> Multi-cloud </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../guides/cp4i/apic/security/overview/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/apic/high-availability/overview/ class=md-nav__link> High Availability </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/apic/disaster-recovery/overview/ class=md-nav__link> Disaster Recovery </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_4 type=checkbox id=__nav_3_5_4> <label class=md-nav__link for=__nav_3_5_4> Automation Decision Services <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Automation Decision Services" data-md-level=3> <label class=md-nav__title for=__nav_3_5_4> <span class="md-nav__icon md-icon"></span> Automation Decision Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4ba/ads/architecture/ads/ class=md-nav__link> Architecture </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_5 type=checkbox id=__nav_3_5_5> <label class=md-nav__link for=__nav_3_5_5> Process Mining <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Process Mining" data-md-level=3> <label class=md-nav__title for=__nav_3_5_5> <span class="md-nav__icon md-icon"></span> Process Mining </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4ba/process-mining/architecture/ibm-cloud/ class=md-nav__link> Architecture </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_6 type=checkbox id=__nav_3_5_6> <label class=md-nav__link for=__nav_3_5_6> Cloud Pak for Data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cloud Pak for Data" data-md-level=3> <label class=md-nav__title for=__nav_3_5_6> <span class="md-nav__icon md-icon"></span> Cloud Pak for Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4d/cpdbase/overview/architecture/ class=md-nav__link> Architecture </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_6_2 type=checkbox id=__nav_3_5_6_2> <label class=md-nav__link for=__nav_3_5_6_2> Base CP <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Base CP" data-md-level=4> <label class=md-nav__title for=__nav_3_5_6_2> <span class="md-nav__icon md-icon"></span> Base CP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4d/cpdbase/overview/cpd-overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_6_3 type=checkbox id=__nav_3_5_6_3> <label class=md-nav__link for=__nav_3_5_6_3> Watson Studio <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Watson Studio" data-md-level=4> <label class=md-nav__title for=__nav_3_5_6_3> <span class="md-nav__icon md-icon"></span> Watson Studio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4d/watsonstudio/overview/cpd-ws-overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_6_4 type=checkbox id=__nav_3_5_6_4> <label class=md-nav__link for=__nav_3_5_6_4> Watson Knowledge Catalog <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Watson Knowledge Catalog" data-md-level=4> <label class=md-nav__title for=__nav_3_5_6_4> <span class="md-nav__icon md-icon"></span> Watson Knowledge Catalog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4d/watsonkc/overview/cpd-wkc-overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_6_5 type=checkbox id=__nav_3_5_6_5> <label class=md-nav__link for=__nav_3_5_6_5> Data Virtualization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Data Virtualization" data-md-level=4> <label class=md-nav__title for=__nav_3_5_6_5> <span class="md-nav__icon md-icon"></span> Data Virtualization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4d/datavirt/overview/cpd-dv-overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_6_6 type=checkbox id=__nav_3_5_6_6> <label class=md-nav__link for=__nav_3_5_6_6> Spectrum Protect Plus <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Spectrum Protect Plus" data-md-level=4> <label class=md-nav__title for=__nav_3_5_6_6> <span class="md-nav__icon md-icon"></span> Spectrum Protect Plus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4d/spplus/overview/spp-overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Hands-on <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Hands-on data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Hands-on </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/using/ class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2> Infrastructure Setup <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Infrastructure Setup" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Infrastructure Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../infra-overview/ class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_2 type=checkbox id=__nav_4_2_2 checked> <label class=md-nav__link for=__nav_4_2_2> Managed Clusters <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Managed Clusters" data-md-level=3> <label class=md-nav__title for=__nav_4_2_2> <span class="md-nav__icon md-icon"></span> Managed Clusters </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> IBM ROKS <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> IBM ROKS </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#deploy-vpc class=md-nav__link> Deploy VPC </a> <nav class=md-nav aria-label="Deploy VPC"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#select-an-ibm-cloud-region class=md-nav__link> Select an IBM Cloud region </a> </li> <li class=md-nav__item> <a href=#create-a-resource-group-or-use-one-already-created class=md-nav__link> Create a resource group or use one already created </a> </li> <li class=md-nav__item> <a href=#create-a-vpc class=md-nav__link> Create a VPC </a> </li> <li class=md-nav__item> <a href=#create-the-ip-address-network-ranges class=md-nav__link> Create the IP address network ranges </a> </li> <li class=md-nav__item> <a href=#create-the-subnets class=md-nav__link> Create the subnets </a> </li> <li class=md-nav__item> <a href=#create-public-gateways-for-outbound-connectivity class=md-nav__link> Create Public Gateways for outbound connectivity </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-vpn-gateway class=md-nav__link> Deploy VPN Gateway </a> <nav class=md-nav aria-label="Deploy VPN Gateway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-vpn-tunnel-to-connect-to-the-vpc class=md-nav__link> Create a VPN tunnel to connect to the VPC </a> </li> <li class=md-nav__item> <a href=#ike-policy class=md-nav__link> IKE-Policy </a> </li> <li class=md-nav__item> <a href=#ipsec-policy class=md-nav__link> IPsec-Policy </a> </li> <li class=md-nav__item> <a href=#create-the-vpn-gateway class=md-nav__link> Create the VPN-Gateway </a> </li> <li class=md-nav__item> <a href=#create-an-ipsec-connection class=md-nav__link> Create an IPsec connection </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-roks class=md-nav__link> Deploy ROKS </a> <nav class=md-nav aria-label="Deploy ROKS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-cloud-object-storage-instance class=md-nav__link> Create a Cloud Object Storage instance </a> </li> <li class=md-nav__item> <a href=#create-the-roks-cluster class=md-nav__link> Create the ROKS cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-gitops class=md-nav__link> Deploy GitOps </a> <nav class=md-nav aria-label="Deploy GitOps"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#install-the-gitops-operator class=md-nav__link> Install the GitOps operator </a> </li> <li class=md-nav__item> <a href=#apply-the-3-layer-gitops-structure class=md-nav__link> Apply the 3-layer GitOps structure </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../rosa/ class=md-nav__link> Amazon ROSA </a> </li> <li class=md-nav__item> <a href=../aro/ class=md-nav__link> Microsoft ARO </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_3 type=checkbox id=__nav_4_2_3> <label class=md-nav__link for=__nav_4_2_3> Unmanaged Clusters <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Unmanaged Clusters" data-md-level=3> <label class=md-nav__title for=__nav_4_2_3> <span class="md-nav__icon md-icon"></span> Unmanaged Clusters </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws/ class=md-nav__link> Amazon AWS </a> </li> <li class=md-nav__item> <a href=../azure/ class=md-nav__link> Microsoft Azure </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../restricted-networks/ class=md-nav__link> Restricted Networks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quickstart/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../quickstart/quickstart-gitops/ class=md-nav__link> GitOps </a> </li> <li class=md-nav__item> <a href=../../quickstart/quickstart-ace/ class=md-nav__link> ACE (CP4I) </a> </li> <li class=md-nav__item> <a href=../../quickstart/quickstart-mq/ class=md-nav__link> MQ (CP4I) </a> </li> <li class=md-nav__item> <a href=../../quickstart/quickstart-process-mining/ class=md-nav__link> Process Mining (CP4BA) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> Step-by-step <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Step-by-step data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Step-by-step </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/guides-overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../guides/ace-overview/ class=md-nav__link> ACE </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_3 type=checkbox id=__nav_4_4_3> <label class=md-nav__link for=__nav_4_4_3> MQ <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MQ data-md-level=3> <label class=md-nav__title for=__nav_4_4_3> <span class="md-nav__icon md-icon"></span> MQ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/using/this-guide/ class=md-nav__link> Using this guide </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_3_2 type=checkbox id=__nav_4_4_3_2> <label class=md-nav__link for=__nav_4_4_3_2> Cloud Native MQ <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cloud Native MQ" data-md-level=4> <label class=md-nav__title for=__nav_4_4_3_2> <span class="md-nav__icon md-icon"></span> Cloud Native MQ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/overview/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/overview/architecture/ class=md-nav__link> Target Architecture </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_3_3 type=checkbox id=__nav_4_4_3_3> <label class=md-nav__link for=__nav_4_4_3_3> Create the cluster <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Create the cluster" data-md-level=4> <label class=md-nav__title for=__nav_4_4_3_3> <span class="md-nav__icon md-icon"></span> Create the cluster </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/cluster-create/ibm-setup/ class=md-nav__link> IBM Cloud </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_3_4 type=checkbox id=__nav_4_4_3_4> <label class=md-nav__link for=__nav_4_4_3_4> Configure the cluster <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Configure the cluster" data-md-level=4> <label class=md-nav__title for=__nav_4_4_3_4> <span class="md-nav__icon md-icon"></span> Configure the cluster </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/cluster-config/gitops-tekton-argocd/ class=md-nav__link> GitOps, Tekton & ArgoCD </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/cluster-config/gitops-config/ class=md-nav__link> Getting started with GitOps </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/cluster-config/services/ class=md-nav__link> Deploying Services </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_3_5 type=checkbox id=__nav_4_4_3_5> <label class=md-nav__link for=__nav_4_4_3_5> Build Queue Manager <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Build Queue Manager" data-md-level=4> <label class=md-nav__title for=__nav_4_4_3_5> <span class="md-nav__icon md-icon"></span> Build Queue Manager </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/qmgr-pipeline/topic1/ class=md-nav__link> Configuring the pipeline </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/qmgr-pipeline/topic2/ class=md-nav__link> Running the pipeline </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/qmgr-pipeline/topic3/ class=md-nav__link> Deploying and using </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/qmgr-pipeline/topic4/ class=md-nav__link> Continuous updates </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_3_6 type=checkbox id=__nav_4_4_3_6> <label class=md-nav__link for=__nav_4_4_3_6> Build MQ application <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Build MQ application" data-md-level=4> <label class=md-nav__title for=__nav_4_4_3_6> <span class="md-nav__icon md-icon"></span> Build MQ application </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/app-pipeline/topic1/ class=md-nav__link> Sample application </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/app-pipeline/topic2/ class=md-nav__link> Configuring the pipeline </a> </li> <li class=md-nav__item> <a href=../../guides/cp4i/mq/app-pipeline/topic3/ class=md-nav__link> Managing an application change </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_3_7 type=checkbox id=__nav_4_4_3_7> <label class=md-nav__link for=__nav_4_4_3_7> Architecture Decisions <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Architecture Decisions" data-md-level=4> <label class=md-nav__title for=__nav_4_4_3_7> <span class="md-nav__icon md-icon"></span> Architecture Decisions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/cp4i/mq/ad/ class=md-nav__link> Decision Index </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../guides/apic-overview/ class=md-nav__link> APIC </a> </li> <li class=md-nav__item> <a href=../../guides/process-mining-overview/ class=md-nav__link> Process Mining </a> </li> <li class=md-nav__item> <a href=../../guides/cp4d-overview/ class=md-nav__link> Cloud Pak for Data </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> References <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=References data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> References </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contribute/documentation/ class=md-nav__link> Contribute </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#deploy-vpc class=md-nav__link> Deploy VPC </a> <nav class=md-nav aria-label="Deploy VPC"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#select-an-ibm-cloud-region class=md-nav__link> Select an IBM Cloud region </a> </li> <li class=md-nav__item> <a href=#create-a-resource-group-or-use-one-already-created class=md-nav__link> Create a resource group or use one already created </a> </li> <li class=md-nav__item> <a href=#create-a-vpc class=md-nav__link> Create a VPC </a> </li> <li class=md-nav__item> <a href=#create-the-ip-address-network-ranges class=md-nav__link> Create the IP address network ranges </a> </li> <li class=md-nav__item> <a href=#create-the-subnets class=md-nav__link> Create the subnets </a> </li> <li class=md-nav__item> <a href=#create-public-gateways-for-outbound-connectivity class=md-nav__link> Create Public Gateways for outbound connectivity </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-vpn-gateway class=md-nav__link> Deploy VPN Gateway </a> <nav class=md-nav aria-label="Deploy VPN Gateway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-vpn-tunnel-to-connect-to-the-vpc class=md-nav__link> Create a VPN tunnel to connect to the VPC </a> </li> <li class=md-nav__item> <a href=#ike-policy class=md-nav__link> IKE-Policy </a> </li> <li class=md-nav__item> <a href=#ipsec-policy class=md-nav__link> IPsec-Policy </a> </li> <li class=md-nav__item> <a href=#create-the-vpn-gateway class=md-nav__link> Create the VPN-Gateway </a> </li> <li class=md-nav__item> <a href=#create-an-ipsec-connection class=md-nav__link> Create an IPsec connection </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-roks class=md-nav__link> Deploy ROKS </a> <nav class=md-nav aria-label="Deploy ROKS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-cloud-object-storage-instance class=md-nav__link> Create a Cloud Object Storage instance </a> </li> <li class=md-nav__item> <a href=#create-the-roks-cluster class=md-nav__link> Create the ROKS cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-gitops class=md-nav__link> Deploy GitOps </a> <nav class=md-nav aria-label="Deploy GitOps"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#install-the-gitops-operator class=md-nav__link> Install the GitOps operator </a> </li> <li class=md-nav__item> <a href=#apply-the-3-layer-gitops-structure class=md-nav__link> Apply the 3-layer GitOps structure </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.ibm.com/cloudpakbringup/production-deployment-guides/edit/master/docs/infrastructure/roks.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=ibm-red-hat-openshift-kubernetes-service-roks>IBM Red Hat OpenShift Kubernetes Service (ROKS)<a class=headerlink href=#ibm-red-hat-openshift-kubernetes-service-roks title="Permanent link">&para;</a></h1> <!--- cSpell:ignore qube cntk autoplay allowfullscreen Paks refarch infraconfig --> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>Red Hat OpenShift Kubernetes Service (ROKS) is a managed service, which that implies that IBM Cloud manages the masters and are not visible to the users. The target production architecture for a production cluster in a single region is:</p> <p><img alt="Target Architecture" src=../images/roks/IBM_VPC_ROKS_split.jpg></p> <p>The split of components showed above shows the following:</p> <ul> <li>Infra nodes: they host Image Registry, Ingress controllers (custom and default), default Routers, Red Hat Marketplace. This node type does not consume licenses from the OpenShift entitlement.</li> <li>Storage nodes: they host Openshift Container Storage components.</li> <li>Cloud Paks nodes: they host the Cloud Paks.ß</li> </ul> <h2 id=deploy-vpc>Deploy VPC<a class=headerlink href=#deploy-vpc title="Permanent link">&para;</a></h2> <h3 id=select-an-ibm-cloud-region>Select an IBM Cloud region<a class=headerlink href=#select-an-ibm-cloud-region title="Permanent link">&para;</a></h3> <p>To get the available regions for VPC run <code>ibmcloud is regions</code></p> <div class=highlight><pre><span></span><code>ibmcloud target -r <span class=nv>$region</span>  
</code></pre></div> <h3 id=create-a-resource-group-or-use-one-already-created>Create a resource group or use one already created<a class=headerlink href=#create-a-resource-group-or-use-one-already-created title="Permanent link">&para;</a></h3> <p>To get the resource groups available <code>ibmcloud resource groups</code>. Create a group if necessary: </p> <div class=highlight><pre><span></span><code>ibmcloud resource group-create <span class=nv>$name</span>
</code></pre></div> <p>Select the group:</p> <div class=highlight><pre><span></span><code>ibmcloud target -g <span class=nv>$name</span>
</code></pre></div> <h3 id=create-a-vpc>Create a VPC<a class=headerlink href=#create-a-vpc title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>ibmcloud is vpc-create <span class=nv>$vpc_name</span> --resource-group-name <span class=nv>$resourcegroup</span> --address-prefix-management manual
</code></pre></div> <h3 id=create-the-ip-address-network-ranges>Create the IP address network ranges<a class=headerlink href=#create-the-ip-address-network-ranges title="Permanent link">&para;</a></h3> <p>It is needed to create one per node type and zone: infra, storage, cloud paks, and workers. For example, for infra nodes, it is needed three IP address network ranges, one network range address per zone. The network ranges must be big enough to allocate IPs for all nodes of each type in each zone. $range must differ from one network range to other, it can be a created different ones if it creates the minimum number of IPs needed for the nodes.</p> <p>To get available zones on the VPC region targeted run <code>ibmcloud is zones</code>, and to get the $vpc_id <code>ibmcloud is vpcs</code>:</p> <div class=highlight><pre><span></span><code>ibmcloud is vpc-address-prefix-create subnet-infra-1 <span class=nv>$vpc_id</span> <span class=nv>$zone_1</span> <span class=m>192</span>.168.<span class=nv>$range_1</span>.0/28
ibmcloud is vpc-address-prefix-create subnet-infra-2 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_2</span>.0/28
ibmcloud is vpc-address-prefix-create subnet-infra-3 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_3</span>.0/28
</code></pre></div> <p>Repeat the process for the rest of the node types: storage, cloud paks, and workers.</p> <div class=highlight><pre><span></span><code>ibmcloud is vpc-address-prefix-create subnet-storage-1 <span class=nv>$vpc_id</span> <span class=nv>$zone_1</span> <span class=m>192</span>.168.<span class=nv>$range_4</span>.0/28
ibmcloud is vpc-address-prefix-create subnet-storage-2 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_5</span>.0/28
ibmcloud is vpc-address-prefix-create subnet-storage-3 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_6</span>.0/28
ibmcloud is vpc-address-prefix-create subnet-cloud-paks-1 <span class=nv>$vpc_id</span> <span class=nv>$zone_1</span> <span class=m>192</span>.168.<span class=nv>$range_7</span>.0/27
ibmcloud is vpc-address-prefix-create subnet-cloud-paks-2 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_8</span>.0/27
ibmcloud is vpc-address-prefix-create subnet-cloud-paks-3 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_9</span>.0/27
ibmcloud is vpc-address-prefix-create subnet-workers-1 <span class=nv>$vpc_id</span> <span class=nv>$zone_1</span> <span class=m>192</span>.168.<span class=nv>$range_10</span>.0/27
ibmcloud is vpc-address-prefix-create subnet-workers-2 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_11</span>.0/27
ibmcloud is vpc-address-prefix-create subnet-workers-3 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span> <span class=m>192</span>.168.<span class=nv>$range_12</span>.0/27
</code></pre></div> <p>Create an IP address network range for the subnet where the VPN Gateway will be deployed:</p> <div class=highlight><pre><span></span><code>ibmcloud is vpc-address-prefix-create subnet-vpn-gw <span class=nv>$vpc_id</span> <span class=nv>$zone_1</span> <span class=m>192</span>.168.<span class=nv>$range_13</span>.0/29
</code></pre></div> <h3 id=create-the-subnets>Create the subnets<a class=headerlink href=#create-the-subnets title="Permanent link">&para;</a></h3> <p>It is needed to create one per node type and zone: infra, storage, cloud paks, and workers. For example, for infra nodes, it is needed three subnets, one subnet per zone. It is needed to apply the IP address range to each subnet. For example, for infra nodes:</p> <div class=highlight><pre><span></span><code>ibmcloud is subnet-create subnet-infra-1 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_1</span>.0/28 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-infra-2 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_2</span>.0/28 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-infra-3 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_3</span>.0/28 --resource-group-name <span class=nv>$resourcegroup</span>
</code></pre></div> <p>Repeat the process for the rest of the node types: storage, cloud paks, and workers.</p> <div class=highlight><pre><span></span><code>ibmcloud is subnet-create subnet-storage-1 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_4</span>.0/28 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-storage-2 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_5</span>.0/28 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-storage-3 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_6</span>.0/28 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-cloud-paks-1 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_7</span>.0/27 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-cloud-paks-2 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_8</span>.0/27 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-cloud-paks-3 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_9</span>.0/27 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-workers-1 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_10</span>.0/27 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-workers-2 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_11</span>.0/27 --resource-group-name <span class=nv>$resourcegroup</span>
ibmcloud is subnet-create subnet-worker-3 <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_12</span>.0/27 --resource-group-name <span class=nv>$resourcegroup</span>
</code></pre></div> <p>Create the subnet to place the VPN Gateway:</p> <div class=highlight><pre><span></span><code>ibmcloud is subnet-create subnet-vpn-gw <span class=nv>$vpc_id</span> --ipv4-cidr-block <span class=m>192</span>.168.<span class=nv>$range_13</span>.0/29 --resource-group-name <span class=nv>$resourcegroup</span>
</code></pre></div> <h3 id=create-public-gateways-for-outbound-connectivity>Create Public Gateways for outbound connectivity<a class=headerlink href=#create-public-gateways-for-outbound-connectivity title="Permanent link">&para;</a></h3> <p>It is needed to create one per zone.</p> <div class=highlight><pre><span></span><code>ibmcloud is public-gateway-create gw-subnet-zone-1 <span class=nv>$vpc_id</span> <span class=nv>$zone_1</span>
ibmcloud is public-gateway-create gw-subnet-zone-2 <span class=nv>$vpc_id</span> <span class=nv>$zone_2</span>
ibmcloud is public-gateway-create gw-subnet-zone-3 <span class=nv>$vpc_id</span> <span class=nv>$zone_3</span>
</code></pre></div> <p>Attach the public gateways on all the subnets that need outbound connectivity to the Internet.</p> <p>Run <code>ibmcloud is subnets</code> to get the subnets ID, and <code>ibmcloud is public-gateways</code> to get the public gateway ID:</p> <div class=highlight><pre><span></span><code>ibmcloud is subnet-update <span class=nv>$subnet</span>-infra-1_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-1_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-infra-2_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-2_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-infra-3_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-3_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-cloud-paks-1_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-1_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-cloud-paks-2_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-2_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-cloud-paks-3_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-3_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-workers-1_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-1_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-workers-2_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-2_id
ibmcloud is subnet-update <span class=nv>$subnet</span>-workers-3_id --public-gateway-id <span class=nv>$gw</span>-subnet-zone-3_id
</code></pre></div> <h2 id=deploy-vpn-gateway>Deploy VPN Gateway<a class=headerlink href=#deploy-vpn-gateway title="Permanent link">&para;</a></h2> <h3 id=create-a-vpn-tunnel-to-connect-to-the-vpc>Create a VPN tunnel to connect to the VPC<a class=headerlink href=#create-a-vpn-tunnel-to-connect-to-the-vpc title="Permanent link">&para;</a></h3> <p>The <a href="https://cloud.ibm.com/docs/vpc?topic=vpc-using-vpn">documentation</a> from IBM Cloud explains each parameter needed to establish the IPsec tunnel that will connect the location of our premises with the VPC on IBM Cloud.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>IBM Cloud offers a set of recommendation parameters for a certain set of devices <a href="https://cloud.ibm.com/docs/vpc?topic=vpc-vpn-onprem-example">here</a></p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>VMware is not on the list but this article describes how to get it on VMWare environments: "https://medium.com/ibm-garage/extending-on-premise-vmware-environment-with-an-ipsec-tunnel-to-consume-securely-ibm-cloud-13cc9326dce1"</p> </div> <p>The next resources need to be created according to the previous recommendations or the requirements needed to establish the IPsec tunnel.</p> <h3 id=ike-policy>IKE-Policy<a class=headerlink href=#ike-policy title="Permanent link">&para;</a></h3> <p>The options available for this parameter can be seen running this command <code>ibmcloud is ike-policy-create --help</code></p> <div class=highlight><pre><span></span><code>ibmcloud is ike-policy-create <span class=nv>$vpc_name</span> <span class=nv>$auth_algorithm_ike</span> <span class=nv>$dh_group_ike</span> <span class=nv>$encryption_ike</span> <span class=nv>$ike_version</span> --key-lifetime _lifetime_ike --resource-group-name <span class=nv>$resourcegroup</span>
</code></pre></div> <h3 id=ipsec-policy>IPsec-Policy<a class=headerlink href=#ipsec-policy title="Permanent link">&para;</a></h3> <p>The options available for this parameter can be seen running this command <code>ibmcloud is ipsec-policy-create --help</code></p> <div class=highlight><pre><span></span><code>ibmcloud is ipsec-policy-create <span class=nv>$vpc_name</span>-ipsec <span class=nv>$auth_algorithm_ipsec</span> <span class=nv>$encryption_ipsec</span> <span class=nv>$pfs_ipsec</span> --key-lifetime <span class=nv>$key_lifetime_ipsec</span> source-group-name <span class=nv>$resourcegroup</span>
</code></pre></div> <h3 id=create-the-vpn-gateway>Create the VPN-Gateway<a class=headerlink href=#create-the-vpn-gateway title="Permanent link">&para;</a></h3> <p>$vpn_subnet is the subnet where the VPN gateway will be deployed. It can be a dedicated subnet or one of the infra subnets</p> <div class=highlight><pre><span></span><code>ibmcloud is vpn-gateway-create <span class=nv>$vpc_name</span> <span class=nv>$subnet</span>-vpn-gw_ID --mode <span class=nv>$policy</span> --resource-group-name <span class=nv>$resourcegroup</span>
</code></pre></div> <h3 id=create-an-ipsec-connection>Create an IPsec connection<a class=headerlink href=#create-an-ipsec-connection title="Permanent link">&para;</a></h3> <p>To check the parameters needed <code>ibmcloud is vpn-gateway-connection-create --help</code>. To get the id of the IKE policies run <code>ibmcloud is ike-policies</code> and to get the IPsec policies <code>ibmcloud is ipsec-policies</code>, to get the vpn gateway ID run <code>ibmcloud is vpn-gateways</code>:</p> <div class=highlight><pre><span></span><code>ibmcloud is vpn-gateway-connection-create <span class=nv>$vpc_name</span> <span class=nv>$vpn_id</span> <span class=nv>$peer_address</span> <span class=nv>$pre_shared_key</span> --ike-policy <span class=nv>$ike_id</span> --ipsec-policy <span class=nv>$ipsec_id</span>
</code></pre></div> <p>If the policy selected was <code>route</code> based when the VPN Gateway was created, a route table is needed to be created:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>As an example here is described how to connect to a VMware environment as is described in the article shown above</p> </div> <div class=highlight><pre><span></span><code>ibmcloud is vpc-routing-table-create <span class=nv>$vpc_id</span> --vpc-zone-ingress <span class=nb>false</span> --name <span class=nv>$vpc_name</span>
</code></pre></div> <p>Attach all the subnets to the route table, to get the ID of the route table run <code>ibmcloud is vpc-routing-tables</code>:</p> <div class=highlight><pre><span></span><code>ibmcloud is subnet-update  <span class=nv>$subnet</span>-infra-1_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-infra-2_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-infra-3_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-storage-1_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-storage-2_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-storage-3_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-cloud-paks-1_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-cloud-paks-2_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-cloud-paks-3_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-workers-1_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-workers-2_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-workers-3_ID --routing-table-id <span class=nv>$route_table_ID</span>
ibmcloud is subnet-update  <span class=nv>$subnet</span>-vpn-gw_ID --routing-table-id <span class=nv>$route_table_ID</span>
</code></pre></div> <p>To add the routes: Each subnet needs a route to the remote network address range. $network_remote is the network address range of the remote network from h ROKS will be accessed. To get the connection ID run <code>ibmcloud is vpn-gateway-connections $vpn-gw_ID</code> For example for infra subnets:</p> <div class=highlight><pre><span></span><code>ibmcloud is vpc-routing-table-route-create <span class=nv>$vpc_id</span> <span class=nv>$route_table_id</span> --name subnet-infra-1  --zone  <span class=nv>$zone_1</span> --destination work_remote --action deliver --next-hop <span class=nv>$connection_id</span>
ibmcloud is vpc-routing-table-route-create <span class=nv>$vpc_id</span> <span class=nv>$route_table_id</span> --name subnet-infra-2  --zone  <span class=nv>$zone_2</span> --destination work_remote --action deliver --next-hop <span class=nv>$connection_id</span>
ibmcloud is vpc-routing-table-route-create <span class=nv>$vpc_id</span> <span class=nv>$route_table_id</span> --name subnet-infra-3  --zone  <span class=nv>$zone_3</span> --destination work_remote --action deliver --next-hop <span class=nv>$connection_id</span>
</code></pre></div> <h2 id=deploy-roks>Deploy ROKS<a class=headerlink href=#deploy-roks title="Permanent link">&para;</a></h2> <h3 id=create-a-cloud-object-storage-instance>Create a Cloud Object Storage instance<a class=headerlink href=#create-a-cloud-object-storage-instance title="Permanent link">&para;</a></h3> <p>Create a Cloud Object Storage instance to host the images of the registry among others:</p> <div class=highlight><pre><span></span><code>ibmcloud resource service-instance-create <span class=nv>$cos_name</span> cloud-object-storage standard global -g <span class=nv>$resourcegroup</span>
</code></pre></div> <h3 id=create-the-roks-cluster>Create the ROKS cluster<a class=headerlink href=#create-the-roks-cluster title="Permanent link">&para;</a></h3> <p>There is a CLI limitation that does not allow the creation of several zones deployment for nodes from the start, it needs to be added after, either change the <code>default</code> worker pool from <code>default</code>. The public endpoint is disabled for security, public outbound connectivity is enabled through the public gateways though.</p> <p>To get the flavors available on the zone/region <code>ibmcloud oc flavors --zone $zone_1</code></p> <p>To get the Openshift versions available <code>ibmcloud oc versions</code>. The recommended version at the moment that this guide was written is <code>4.6.28_openshift</code>.</p> <p>To get the CRN (ID of the storage instance) of the Object Storage instance, run <code>ibmcloud resource service-instance $cos_name</code></p> <div class=highlight><pre><span></span><code>ibmcloud oc cluster create vpc-gen2 --name <span class=nv>$cluster_name</span> --vpc-id <span class=nv>$vpc_id</span> --workers <span class=m>2</span> --version <span class=nv>$version</span> --flavor <span class=nv>$flavor</span> --zone e_1 --subnet-id <span class=nv>$subnet</span>-workers-1_id --cos-instance <span class=nv>$cos_id</span> --disable-public-service-endpoint
</code></pre></div> <p>To extend the default worker pool to the other two zones:</p> <p>To get the ROKS cluster ID run <code>ibmcloud oc clusters</code></p> <div class=highlight><pre><span></span><code>ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-workers-2_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_2</span> --worker-pool default
ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-workers-3_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_3</span> --worker-pool default
</code></pre></div> <p>To create the Infra worker pool: If you are bringing your own license use the flag <code>cloud_pak</code> for the entitlement, in the case you want to consume the entitlement directly from IBM Cloud remove the flag.</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool create vpc-gen2 --name infra --cluster <span class=nv>$roks_id</span> --flavor <span class=nv>$flavor_infra</span> --size-per-zone <span class=m>1</span> --vpc-id <span class=nv>$vpc_id</span> titlement cloud_pak --label node-role.kubernetes.io/infra<span class=o>=</span><span class=nb>true</span>
</code></pre></div> <p>Extending the worker pool across the three zones:</p> <div class=highlight><pre><span></span><code>ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-infra-1_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_1</span> --worker-pool infra
ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-infra-2_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_2</span> --worker-pool infra
ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-infra-3_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_3</span> --worker-pool infra
</code></pre></div> <p>To create the Storage worker pool:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This step is optional, just needed if your workloads need shared storage</p> </div> <p>If you are bringing your own license use the flag <code>cloud_pak</code> for the entitlement, in the case you want to consume the entitlement directly from IBM Cloud remove the flag.</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool create vpc-gen2 --name storage --cluster <span class=nv>$roks_id</span> --flavor <span class=nv>$flavor_storage</span> --size-per-zone <span class=m>1</span> --vpc-id <span class=nv>$vpc_id</span> titlement cloud_pak --label node-role.kubernetes.io/storage<span class=o>=</span><span class=nb>true</span>
</code></pre></div> <p>Extending the worker pool across the three zones:</p> <div class=highlight><pre><span></span><code>ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-storage-1_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_1</span> --worker-pool storage
ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-storage-2_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_2</span> --worker-pool storage
ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-storage-3_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_3</span> --worker-pool storage
</code></pre></div> <p>To create the Cloud Pak worker pool: If you are bringing your own license use the flag <code>cloud_pak</code> for the entitlement, in the case you want to consume the entitlement directly from IBM Cloud remove the flag.</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool create vpc-gen2 --name cloud-paks  --cluster <span class=nv>$roks_id</span> --flavor <span class=nv>$flavor_cloud</span>-paks  --size-per-zone <span class=m>1</span> --vpc-id _id --entitlement cloud_pak --label node-role.kubernetes.io/cloud-paks<span class=o>=</span><span class=nb>true</span>
</code></pre></div> <p>Extending the worker pool across the three zones:</p> <div class=highlight><pre><span></span><code>ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-cloud-paks-1_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_1</span> --worker-pool cloud-paks
ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-cloud-paks-2_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_2</span> --worker-pool cloud-paks
ibmcloud oc zone add vpc-gen2 --subnet-id <span class=nv>$subnet</span>-cloud-paks-3_id  --cluster <span class=nv>$roks_id</span> --zone <span class=nv>$zone_3</span> --worker-pool cloud-paks
</code></pre></div> <p>The default roles assigned by IBM Cloud need to be changed, to remove them: Retrieve the admin credentials for the cluster:</p> <div class=highlight><pre><span></span><code>ibmcloud oc cluster config --cluster <span class=nv>$roks_name</span> --admin
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Run <code>oc get nodes</code> to check you are logged in the cluster.</p> </div> <p>Remove the master and worker role labels from nodes, to apply the correct labels to each worker-pool:</p> <div class=highlight><pre><span></span><code>oc get nodes <span class=p>|</span> awk <span class=s1>&#39;{print $1}&#39;</span><span class=p>|</span>awk <span class=s1>&#39;{if(NR&gt;1)print}&#39;</span> <span class=p>|</span> xargs -I <span class=o>{}</span> bash -c <span class=s1>&#39;oc label node {} node-role.kubernetes.io/master-&#39;</span>
</code></pre></div> <p>The worker nodes need to be labeled and tainted: The <code>default</code> worker pool can be used to host applications that don`t fit with the infra workloads, storage workloads, or Cloud Pak workloads. To label the worker pool run:</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool label <span class=nb>set</span> --cluster <span class=nv>$roks_name</span> --worker-pool default --label node-role.kubernetes.io/worker<span class=o>=</span><span class=s1>&#39;&#39;</span>
</code></pre></div> <p>Apply the label to the infra nodes:</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool label <span class=nb>set</span> --cluster <span class=nv>$roks_name</span> --worker-pool default --label node-role.kubernetes.io/worker<span class=o>=</span><span class=nb>true</span>  -f
</code></pre></div> <p>Apply the label to the cloud-paks nodes:</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool label <span class=nb>set</span> --cluster <span class=nv>$roks_name</span> --worker-pool cloud-paks --label node-role.kubernetes.io/cloud-paks<span class=o>=</span><span class=nb>true</span>  -f
</code></pre></div> <p>Apply the label to the worker nodes:</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool label <span class=nb>set</span> --cluster <span class=nv>$roks_name</span> --worker-pool default --label node-role.kubernetes.io/worker<span class=o>=</span><span class=nb>true</span>  -f
</code></pre></div> <p>Apply the taints to the nodes to avoid workloads not related to that node role to be placed in:</p> <p>For the cloud-paks nodes.</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool taint <span class=nb>set</span> --cluster <span class=nv>$roks_name</span> --worker-pool cloud-paks --taint node-role.kubernetes.io/d-paks<span class=o>=</span>true:NoSchedule -f
</code></pre></div> <p>For the infra nodes.</p> <div class=highlight><pre><span></span><code>ibmcloud oc worker-pool taint <span class=nb>set</span> --cluster <span class=nv>$roks_name</span> --worker-pool infra --taint node-role.kubernetes.io/infra<span class=o>=</span>true:NoSchedule -f
</code></pre></div> <h2 id=deploy-gitops>Deploy GitOps<a class=headerlink href=#deploy-gitops title="Permanent link">&para;</a></h2> <h3 id=install-the-gitops-operator>Install the GitOps operator<a class=headerlink href=#install-the-gitops-operator title="Permanent link">&para;</a></h3> <p>Fork and clone the standard repo GitOps for IBM Cloud:</p> <div class=highlight><pre><span></span><code>git clone https://github.ibm.com/jesus-arteche/ibm-pro-roks
</code></pre></div> <p>Install the GitOps operator</p> <div class=highlight><pre><span></span><code>oc apply -f <span class=m>2</span>-services/operators/openshift-gitops/ -n openshift-operators
</code></pre></div> <p>Add the ClusterRoles needed by ArgoCD (GitOps) to Bootstrap the cluster</p> <div class=highlight><pre><span></span><code>oc apply -f <span class=m>3</span>-infra/clusterrole/
</code></pre></div> <h3 id=apply-the-3-layer-gitops-structure>Apply the 3-layer GitOps structure<a class=headerlink href=#apply-the-3-layer-gitops-structure title="Permanent link">&para;</a></h3> <p>Modify the bootstrap.yaml on the root folder file to point to the newly forked repo:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">argoproj.io/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bootstrap</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=nt>destination</span><span class=p>:</span>
    <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">openshift-gitops</span>
    <span class=nt>server</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://kubernetes.default.svc</span>
<span class=nt>project</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>source</span><span class=p>:</span>
    <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0-bootstrap/argocd/active</span>
    <span class=nt>repoURL</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">$YOUR_REPO_URL</span>
    <span class=nt>targetRevision</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
<span class=nt>syncPolicy</span><span class=p>:</span>
    <span class=nt>automated</span><span class=p>:</span>
    <span class=nt>prune</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>selfHeal</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>To deploy the bootstrap app that will roll out the cluster components installation run:</p> <div class=highlight><pre><span></span><code>oc apply -f bootstrap.yaml -n openshift-gitops
</code></pre></div> <p>To grab the ArgoCD credentials and route to access to the dashboard run:</p> <p>password:</p> <div class=highlight><pre><span></span><code><span class=nv>passwd_argocd</span><span class=o>=</span><span class=k>$(</span>oc get secret argocd-cluster-cluster -n openshift-gitops -o json  <span class=p>|</span> jq -r .data <span class=p>|</span> jq -r .<span class=o>[</span><span class=s1>&#39;admin.password&#39;</span><span class=o>]</span> <span class=p>|</span> tail -1 se64 -d<span class=k>)</span>
</code></pre></div> <p>route:</p> <div class=highlight><pre><span></span><code><span class=nv>argo_route</span><span class=o>=</span><span class=k>$(</span>oc get route argocd-cluster-server -n openshift-gitops -o json <span class=p>|</span> jq -r <span class=s1>&#39;.spec.host&#39;</span><span class=k>)</span>
</code></pre></div> <p>If using Github Enterprise it is needed to authenticate against the repo. Follow the next steps:</p> <div class=highlight><pre><span></span><code>argocd login <span class=si>${</span><span class=nv>argo_route</span><span class=si>}</span> --username admin --password <span class=si>${</span><span class=nv>passwd_argocd</span><span class=si>}</span> --insecure
</code></pre></div> <p>Add the repo to the argoCD instance, $github_password is a token created in Github Enterprise with permissions to read the repo:</p> <div class=highlight><pre><span></span><code>argocd  repo add <span class=si>${</span><span class=nv>github_repo</span><span class=si>}</span> --type git --name <span class=nv>$repo_name_to_set</span> --username <span class=si>${</span><span class=nv>github_username</span><span class=si>}</span> --password  <span class=si>${</span><span class=nv>github_password</span><span class=si>}</span> secure
</code></pre></div> <p>The 3-layer structure works by moving the items that need to be set up on the cluster to the active folder. Modify the 3-infra.yaml file in the bootstrap/inactive folder, to point the repoURL and the sourceRepos keys to your repo. Move it to the active folder. Modify again the repoURL and the sourceRepos keys on the refarch-infraconfig.yaml in the 3-infra/argocd/inactive and move it to the active folder. Push it to git.</p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <nav class="md-footer__inner md-grid" aria-label=Footer> <!-- Link to previous page --> <a href=../infra-overview/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Overview </div> </div> </a> <!-- Link to next page --> <a href=../rosa/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Amazon ROSA </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-column> <div class=md-footer-text>Site licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a></div> </div> <div class=md-footer-column> <!-- Copyright and theme information --> <div class=md-footer-text> Copyright © 2021 Cloud Pak Production Deployment Guides </div> </div> <div class=md-footer-social> <a href=https://github.ibm.com/cloudpakbringup/deployment-guides target=_blank rel=noopener title="Production Deployment Guides on Github Enterprise" class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"> <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"> </path> </svg> </a> <a href=https://ibm-cloud.slack.com/archives/C02CQ6M2D2R target=_blank rel=noopener title=Slack class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"> <path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"> </path> </svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.4fc53ad4.min.js></script> </body> </html>